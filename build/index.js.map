{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "../src/",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "'use strict'\r\nsoap = require 'soap'\r\n\r\nmodule.exports = (ndx) ->\r\n  url = process.env.SMS_API_URL or 'https://www.24x2.com/wssecure/service.asmx?WSDL'\r\n  callbacks = \r\n    send: []\r\n    error: []\r\n  safeCallback = (name, obj) ->\r\n    for cb in callbacks[name]\r\n      cb obj\r\n  cleanNo = (num) ->\r\n    num = num.replace /\\+|\\s/g, ''\r\n    num = num.replace /^447/, '07'\r\n    if /^07/.test(num) and /^\\d+$/.test(num) then num else null\r\n  cleanNos = (nos) ->\r\n    outnos = []\r\n    for num in nos\r\n      if outno = cleanNo num\r\n        outnos.push outno\r\n    outnos\r\n  fillTemplate = (template, data) ->\r\n    if template and data\r\n      return template.replace /\\{\\{(.+?)\\}\\}/g, (all, match) ->\r\n        evalInContext = (str, context) ->\r\n          (new Function(\"with(this) {return #{str}}\"))\r\n          .call context\r\n        evalInContext match, data\r\n    else\r\n      return ''\r\n  ndx.sms =\r\n    send: (args, data, cb) ->\r\n      if process.env.SMS_API_USERNAME or ndx.settings.SMS_API_USERNAME\r\n        try\r\n          args.numbers = cleanNos args.numbers\r\n          args.body = fillTemplate args.body, data\r\n        catch e\r\n          console.log 'there was a problem filling the sms template'\r\n          console.log args.body\r\n          return cb? 'template error'\r\n        if not args.body\r\n          return cb? 'template error'\r\n        if process.env.SMS_OVERRIDE\r\n          args.numbers = [process.env.SMS_OVERRIDE]\r\n        if not process.env.SMS_DISABLE\r\n          if args.numbers.length\r\n            smsArgs =\r\n              UserName: process.env.SMS_API_USERNAME or ndx.settings.SMS_API_USERNAME\r\n              Password: process.env.SMS_API_PASSWORD or ndx.settings.SMS_API_PASSWORD\r\n              Mobiles: args.numbers.join(',')\r\n              MessageFrom: process.env.SMS_API_FROM\r\n              MessageToSend: args.body\r\n              DateTimeToSend: new Date().toISOString()\r\n              UserField: ''\r\n              EmailAddressToSendReplies: ''\r\n            soap.createClient url, (err, client) ->\r\n              console.log err if err\r\n              client.SendFullSMS smsArgs, (err, result) ->\r\n                console.log err, result if err\r\n                if err\r\n                  safeCallback 'error', err\r\n                else\r\n                  safeCallback 'send', result\r\n                cb? err, result\r\n        else\r\n          console.log 'sending sms disabled'\r\n      else\r\n        console.log 'no sms api username'\r\n        cb? 'no username'"
  ]
}